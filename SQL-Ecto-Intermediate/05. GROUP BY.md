To group rows that have same value in a particular column and to do aggregate functions in that grouped rows,  `GROUP BY` command is used. 

Example:

![[Pasted image 20231106164959.png]]

if you wanted to know how many records have same value in `salary`, you can group those records by using,

``` SQL
SELECT salary, COUNT(salary) FROM employees GROUP BY salary;
```

Explanation:

- we are selecting `salary` to be appeared in the table. 
- We are counting the salary
- we are grouping the records by salary. Meaning all records whose value in `salary` will get grouped.
-  `salary` will get grouped, the `count(salary)` will count the grouped column. like if 3 columns were grouped together the `count(salary)` will return it as 3.

You have to print the columns which you are trying to group by. For example, if your trying to group by salary, you have to print that. If you try to print a column which doesn't come after the `group by` keyword, you will get an error saying, 

![[Pasted image 20231106170049.png]]

You can see in the above example, that i am grouping by `salary` with counting the `job_id` column. which means it will group the `salary` and count how many `job_id` are grouped. But error is coming because i am trying to print the `job_id` which is a count. 
You apply aggregate function for any column. But for printing, The column which you put after `group by` and the column which got printed has to be the same column.  You can `count` any column. `count` will just count the column, so that we can have a count of how many column is got grouped by.

![[Pasted image 20231106174858.png]]

You can see in the above example, after changing the query to

``` SQL
SELECT salary, COUNT(job_id) FROM employees GROUP BY salary;
```

After i changed `job_id` to `salary`, it is working. 

# Ecto query for `GROUP BY`

#### [group_by/3](https://hexdocs.pm/ecto/Ecto.Query.html#group_by/3)

In Ecto to group the fields that has same value `group_by/3` function is used. `group_by/3` accepting 3 arguments, 

1. A schema
2. Reference variable for the schema
3. A field used to group

**Example:**

``` Elixir
SqlEcto.Hr.Employee |> group_by([e], e.salary) |> select([e], %{"salary" => e.salary, "count" => count(e.job_id)}) |> SqlEcto.Repo.all()
```

So the above query will returned results from grouping the `SqlEcto.Hr.Employees` records whose `salary` are same.

**Explanation**:

` group_by([e], e.salary)` -> 

`[e]` is a reference variable for `SqlEcto.Hr.Employee`. `e.salary` is the field that is grouped by.

`select([e], %{"salary" => e.salary, "count" => count(e.job_id)})` -> 

Here `[e]` is the reference variable. `%{}` is used because we want our results to be in a map. We want our map to return, the grouped `salary` and how many `job_id` got that `salary`.

Result:

![[Pasted image 20231108102150.png]]

So you can see that `salary` got grouped, and we count how many `job_id` of employees got that `salary`. 






















